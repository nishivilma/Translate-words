import csv
import re
import time
import psutil

# Step 1: Read the input files
text_file = 't8.shakespeare.txt'
find_words_file = 'find_words.txt'
dictionary_file = 'french_dictionary.csv'

with open(text_file, 'r') as file:
    text_content = file.read()

with open(find_words_file, 'r') as file:
    find_words = [line.strip() for line in file.readlines()]

dictionary = {}
with open(dictionary_file, 'r') as file:
    reader = csv.reader(file)
    next(reader)  # Skip the header row
    for row in reader:
        english_word = row[0]
        french_word = row[1]
        dictionary[english_word] = french_word

# Step 3: Find and replace words
replaced_words = {}
processed_text = text_content

for word in find_words:
    pattern = r'\b' + re.escape(word) + r'\b'
    matches = re.findall(pattern, processed_text, flags=re.IGNORECASE)
    for match in matches:
        replaced_word = dictionary.get(match.lower())
        if replaced_word:
            processed_text = re.sub(r'\b' + re.escape(match) + r'\b', replaced_word, processed_text, flags=re.IGNORECASE)
            replaced_words[match] = replaced_words.get(match, 0) + 1

# Step 4: Save the processed output
output_file = 't8.shakespeare.translated.txt'
with open(output_file, 'w') as file:
    file.write(processed_text)

# Write the frequency data to CSV
frequency_file = 'frequency.csv'
with open(frequency_file, 'w', newline='') as file:
    writer = csv.writer(file)
    writer.writerow(['English word', 'French word', 'Frequency'])
    for word, frequency in replaced_words.items():
        writer.writerow([word, dictionary[word.lower()], frequency])

# Write the performance statistics to a text file
performance_file = 'performance.txt'
process = psutil.Process()
process_memory = process.memory_info().rss / 1024 / 1024  # Memory usage in MB
time_taken = time.process_time()

with open(performance_file, 'w') as file:
    file.write(f"Time to process: {time_taken} seconds\n")
    file.write(f"Memory used: {process_memory} MB\n")
